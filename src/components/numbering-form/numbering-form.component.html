<div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl mx-auto border border-gray-200">
  <h2 class="text-2xl font-bold text-gray-900 mb-6">Input Penomoran Surat</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    <div class="grid grid-cols-1 gap-6">
      
      <div>
        <label for="jenisNaskah" class="block text-sm font-medium text-gray-700">Jenis Naskah</label>
        <select id="jenisNaskah" formControlName="jenisNaskah" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
          <option value="" disabled>Pilih Jenis Naskah</option>
          @for(item of jenisNaskahOptions; track item) {
            <option [value]="item">{{ item }}</option>
          }
        </select>
        @if (form.get('jenisNaskah')?.invalid && form.get('jenisNaskah')?.touched) {
          <p class="text-red-500 text-xs mt-1">Jenis naskah wajib diisi.</p>
        }
      </div>

      <div>
        <label for="sifatNaskah" class="block text-sm font-medium text-gray-700">Sifat Naskah</label>
        <select id="sifatNaskah" formControlName="sifatNaskah" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
           @for(item of sifatNaskahOptions; track item) {
            <option [value]="item">{{ item }}</option>
          }
        </select>
      </div>

      <div>
        <label for="tanggalSurat" class="block text-sm font-medium text-gray-700">Tanggal Surat</label>
        <input type="date" id="tanggalSurat" formControlName="tanggalSurat" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
      </div>

      <div>
        <label for="kodeKlasifikasi" class="block text-sm font-medium text-gray-700">Kode Klasifikasi</label>
        <select id="kodeKlasifikasi" formControlName="kodeKlasifikasi" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
           <option value="" disabled>Pilih Kode</option>
           @for(klasifikasi of klasifikasiList(); track klasifikasi.kode) {
            <option [value]="klasifikasi.kode">{{ klasifikasi.kode }} - {{ klasifikasi.deskripsi }}</option>
          }
        </select>
         @if (form.get('kodeKlasifikasi')?.invalid && form.get('kodeKlasifikasi')?.touched) {
          <p class="text-red-500 text-xs mt-1">Kode klasifikasi wajib diisi.</p>
        }
      </div>

      @if (availableTurunan().length > 0) {
        <div>
          <label for="kodeTurunan" class="block text-sm font-medium text-gray-700">Kode Turunan</label>
          <select id="kodeTurunan" formControlName="kodeTurunan" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
            <option value="">-- Pilih Kode Turunan (Opsional) --</option>
            @for(turunan of availableTurunan(); track turunan.kode) {
              <option [value]="turunan.kode">{{ turunan.kode }} - {{ turunan.deskripsi }}</option>
            }
          </select>
        </div>
      }

      <div>
        <label for="perihal" class="block text-sm font-medium text-gray-700">Perihal</label>
        <input type="text" id="perihal" formControlName="perihal" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm" placeholder="Contoh: Undangan Rapat Pleno">
        @if (form.get('perihal')?.hasError('required') && form.get('perihal')?.touched) {
          <p class="text-red-500 text-xs mt-1">Perihal wajib diisi.</p>
        }
        @if (form.get('perihal')?.hasError('minlength') && form.get('perihal')?.touched) {
          <p class="text-red-500 text-xs mt-1">Perihal minimal 10 karakter.</p>
        }
      </div>
      
      <div>
        <label for="tujuan" class="block text-sm font-medium text-gray-700">Tujuan</label>
        <input type="text" id="tujuan" formControlName="tujuan" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm" placeholder="Contoh: Ketua KPU Kabupaten Rokan Hulu">
        @if (form.get('tujuan')?.hasError('required') && form.get('tujuan')?.touched) {
          <p class="text-red-500 text-xs mt-1">Tujuan wajib diisi.</p>
        }
         @if (form.get('tujuan')?.hasError('minlength') && form.get('tujuan')?.touched) {
          <p class="text-red-500 text-xs mt-1">Tujuan minimal 5 karakter.</p>
        }
      </div>

      <div>
        <label for="isiRingkas" class="block text-sm font-medium text-gray-700">Isi Ringkasan (Opsional)</label>
        <textarea id="isiRingkas" formControlName="isiRingkas" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"></textarea>
      </div>

      <div>
        <label for="penandatangan" class="block text-sm font-medium text-gray-700">Penandatangan</label>
        <select id="penandatangan" formControlName="penandatangan" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
           <option value="" disabled>Pilih Penandatangan</option>
           @for(p of penandatanganOptions; track p.nama) {
            <option [value]="p.nama">{{ p.jabatan }} - {{ p.nama }}</option>
          }
        </select>
        @if (form.get('penandatangan')?.invalid && form.get('penandatangan')?.touched) {
          <p class="text-red-500 text-xs mt-1">Penandatangan wajib diisi.</p>
        }
      </div>

      <div>
        <label for="staf" class="block text-sm font-medium text-gray-700">Staf</label>
        <select id="staf" formControlName="staf" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
           <option value="" disabled>Pilih Staf</option>
           @for(item of stafOptions; track item) {
            <option [value]="item">{{ item }}</option>
          }
        </select>
        @if (form.get('staf')?.invalid && form.get('staf')?.touched) {
          <p class="text-red-500 text-xs mt-1">Staf wajib dipilih.</p>
        }
      </div>

    </div>

    <div class="flex justify-end pt-4">
      <button type="submit" [disabled]="form.invalid" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:bg-gray-400 disabled:cursor-not-allowed">
        Buat Nomor Surat
      </button>
    </div>
  </form>
</div>

<!-- Success Modal -->
@if (showSuccessModal()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-md text-center">
      <!-- Icon -->
      <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
        <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
        </svg>
      </div>

      <h3 class="text-xl font-semibold text-gray-900 mt-4">Sukses!</h3>
      <p class="text-gray-600 mt-2">Nomor surat baru telah berhasil dibuat.</p>
      
      <div class="mt-4 bg-gray-50 border border-dashed border-gray-300 rounded-lg p-3">
        <p class="text-sm text-gray-500">Nomor Surat Anda:</p>
        <p class="text-lg font-mono font-bold text-gray-800 break-all">{{ lastGeneratedNumber() }}</p>
      </div>

      <div class="mt-6 flex flex-col sm:flex-row-reverse gap-3">
        <button (click)="copyAndClose()" type="button" class="w-full inline-flex items-center justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
          Salin & Tutup
        </button>
        <button (click)="closeModal()" type="button" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:text-sm">
          Tutup
        </button>
      </div>
    </div>
  </div>
}
